# Программа для работы с вакансиями с hh.ru и PostgreSQL

Курсовая работа по интеграции с внешним API для получения и обработки вакансий с платформы HeadHunter и сохранения их в базу данных PostgreSQL.

## Описание проекта

Программа позволяет:
- Получать вакансии с hh.ru по поисковому запросу
- Сохранять вакансии в JSON-файл
- Фильтровать вакансии по ключевым словам
- Получать топ N вакансий по зарплате
- Фильтровать вакансии по диапазону зарплат
- Просматривать статистику по вакансиям
- Удалять вакансии из хранилища
- **Работать с базой данных PostgreSQL:**
  - Автоматически создавать таблицы компаний и вакансий
  - Загружать вакансии для 10 компаний в БД
  - Смотреть статистику и делать выборки через SQL (JOIN, AVG, WHERE, LIKE)

## Структура проекта

```
pythonProject6/
│
├── api/                    # Модуль для работы с API
│   ├── __init__.py
│   ├── base_api.py        # Абстрактный класс для API
│   └── hh_api.py          # Класс для работы с hh.ru
│
├── models/                 # Модели данных
│   ├── __init__.py
│   └── vacancy.py         # Класс Vacancy
│
├── storage/               # Модуль для работы с хранилищем
│   ├── __init__.py
│   ├── base_storage.py    # Абстрактный класс для хранилища
│   └── json_saver.py      # Класс для работы с JSON-файлом
│
├── db/                    # Модуль для работы с базой данных
│   ├── __init__.py
│   └── db_manager.py      # Класс DBManager для PostgreSQL
│
├── utils/                 # Утилиты
│   ├── __init__.py
│   └── filters.py         # Функции фильтрации и сортировки
│
├── tests/                 # Тесты
│   ├── __init__.py
│   ├── test_vacancy.py    # Тесты для класса Vacancy
│   ├── test_json_saver.py # Тесты для JSONSaver
│   └── test_filters.py    # Тесты для функций фильтрации
│
├── main.py                # Главный файл программы
├── requirements.txt       # Зависимости проекта
├── .env.example           # Пример файла с параметрами подключения к PostgreSQL
├── pyproject.toml         # Конфигурация проекта
└── README.md             # Документация
```

## Установка и запуск

### 1. Установка PostgreSQL

- Скачайте и установите PostgreSQL: https://www.postgresql.org/download/
- Создайте базу данных и пользователя:

```sql
CREATE DATABASE your_db_name;
CREATE USER your_db_user WITH PASSWORD 'your_db_password';
GRANT ALL PRIVILEGES ON DATABASE your_db_name TO your_db_user;
```

### 2. Настройка .env

- Скопируйте `.env.example` в `.env`:

```bash
cp .env.example .env
```
- Заполните параметры подключения к вашей базе данных PostgreSQL:

```
PG_HOST=localhost
PG_PORT=5432
PG_DATABASE=your_db_name
PG_USER=your_db_user
PG_PASSWORD=your_db_password
```

### 3. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 4. Запуск программы

```bash
python main.py
```

### 5. Запуск тестов (для файлового хранилища и фильтрации)

```bash
pytest tests/
```

## Использование

После запуска программы вы увидите меню с возможными действиями:

1. Поиск вакансий на hh.ru и сохранение в файл
2. Показать сохраненные вакансии (файл)
3. Фильтровать вакансии по ключевым словам (файл)
4. Получить топ N вакансий по зарплате (файл)
5. Фильтровать по диапазону зарплат (файл)
6. Показать статистику (файл)
7. Очистить все сохраненные вакансии (файл)
8. **Загрузить вакансии компаний в БД (hh.ru → PostgreSQL)**
9. **Показать компании и количество вакансий (PostgreSQL)**
10. **Показать все вакансии (PostgreSQL)**
11. **Показать среднюю зарплату (PostgreSQL)**
12. **Показать вакансии с зарплатой выше средней (PostgreSQL)**
13. **Поиск вакансий по ключевому слову (PostgreSQL)**
0. Выход

## Работа с базой данных PostgreSQL

- При первом запуске автоматически создаются таблицы `companies` и `vacancies` (связаны через внешний ключ).
- В таблицу компаний добавляются 10 популярных IT-компаний (Яндекс, Сбер, Тинькофф и др.).
- Вакансии для этих компаний можно загрузить из hh.ru в базу данных PostgreSQL.
- Реализованы SQL-запросы для получения статистики, поиска, фильтрации и аналитики по вакансиям и компаниям.

### Примеры команд меню для работы с БД:
- **8** — загрузить вакансии для 10 компаний в PostgreSQL
- **9** — вывести список компаний и количество вакансий
- **10** — вывести все вакансии с названием компании, зарплатой и ссылкой
- **11** — средняя зарплата по всем вакансиям
- **12** — вакансии с зарплатой выше средней
- **13** — поиск вакансий по ключевому слову в названии

## Примеры использования

### Поиск вакансий
```
Введите поисковый запрос: Python Developer
```

### Фильтрация по ключевым словам
```
Введите ключевые слова через пробел: Django Flask
```

### Получение топ вакансий
```
Введите количество вакансий для вывода в топ N: 5
```

### Фильтрация по зарплате
```
Введите диапазон зарплат (например: 50000-150000 или 100000): 80000-120000
```

### Загрузка вакансий в PostgreSQL
```
Выберите действие: 8
```

### Показ компаний и количества вакансий
```
Выберите действие: 9
```

### Показ вакансий с зарплатой выше средней
```
Выберите действие: 12
```

## Архитектура проекта

### Принципы ООП

1. **Наследование**: `HeadHunterAPI` наследуется от `BaseAPI`, `JSONSaver` наследуется от `BaseStorage`, `DBManager` — отдельный класс для работы с PostgreSQL
2. **Инкапсуляция**: Класс `Vacancy` инкапсулирует данные вакансии и методы валидации
3. **Полиморфизм**: Различные реализации API и хранилища могут быть легко заменены

### Принципы SOLID

1. **Single Responsibility Principle**: Каждый класс имеет одну ответственность
2. **Open/Closed Principle**: Классы открыты для расширения, закрыты для модификации
3. **Liskov Substitution Principle**: Подклассы могут заменять базовые классы
4. **Interface Segregation Principle**: Интерфейсы разделены на специфичные части
5. **Dependency Inversion Principle**: Зависимости от абстракций, а не от конкретных классов

## Классы и их назначение

### BaseAPI (api/base_api.py)
Абстрактный класс, определяющий интерфейс для работы с API сервисов вакансий.

### HeadHunterAPI (api/hh_api.py)
Реализация API для работы с hh.ru. Получает вакансии через HTTP-запросы.

### Vacancy (models/vacancy.py)
Класс для представления вакансии. Содержит:
- Название вакансии
- URL вакансии
- Зарплату (с валидацией)
- Описание
- Требования
- Название компании

Поддерживает методы сравнения по зарплате.

### BaseStorage (storage/base_storage.py)
Абстрактный класс для работы с хранилищем вакансий.

### JSONSaver (storage/json_saver.py)
Реализация хранилища для сохранения вакансий в JSON-файл.

### DBManager (db/db_manager.py)
Класс для работы с базой данных PostgreSQL:
- Автоматическое создание таблиц
- Добавление компаний и вакансий
- SQL-запросы для аналитики и поиска

### Функции фильтрации (utils/filters.py)
Набор функций для:
- Фильтрации по ключевым словам
- Фильтрации по диапазону зарплат
- Сортировки вакансий
- Получения статистики

## Тестирование

Проект включает комплексные тесты для всех основных компонентов (файловое хранилище и фильтрация):

- Тесты класса `Vacancy` (валидация, сравнение, преобразование)
- Тесты класса `JSONSaver` (сохранение, загрузка, фильтрация)
- Тесты функций фильтрации (фильтрация, сортировка, статистика)

## Файлы данных

- `vacancies.json` — файл для сохранения вакансий (создается автоматически)
- **PostgreSQL** — база данных для хранения компаний и вакансий

## Требования

- Python 3.7+
- requests==2.31.0
- pytest==7.4.3
- psycopg2-binary==2.9.9
- python-dotenv==1.0.1
- PostgreSQL 12+

## Лицензия

Этот проект создан в рамках курсовой работы по изучению API, ООП и работы с базами данных в Python. 